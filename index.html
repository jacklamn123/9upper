<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9upper Online</title>

    <!-- ✅ Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .hidden {
            display: none;
        }
        .chatbox {
            width: 300px;
            height: 200px;
            border: 1px solid black;
            overflow-y: auto;
            margin: 10px auto;
            text-align: left;
            padding: 5px;
            background-color: #f0f0f0;
        }
    </style>

    <script>
        // ✅ Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB1PPLZl8380-xEpyVX3z8ya9eRji2H-uk",
            authDomain: "upper-2c864.firebaseapp.com",
            databaseURL: "https://upper-2c864-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "upper-2c864",
            storageBucket: "upper-2c864.firebasestorage.app",
            messagingSenderId: "1065732661608",
            appId: "1:1065732661608:web:2db40ab8d60697b34f6dd",
            measurementId: "G-F348XKS47Q"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        var gameCode = ""; 
        var playerName = "";

        function confirmName() {
            playerName = document.getElementById("playerNameInput").value.trim();
            if (playerName === "") {
                alert("Please enter a valid name!");
                return;
            }
            document.getElementById("nameInput").classList.add("hidden");
            document.getElementById("setupArea").classList.remove("hidden");
        }

        function sendChatMessage() {
            var message = document.getElementById("chatInput").value.trim();
            if (message === "") return;
            db.ref("games/" + gameCode + "/chat").push(playerName + ": " + message);
            document.getElementById("chatInput").value = "";

            // ✅ Scroll to the newest message after sending (with animation)
            setTimeout(() => scrollChatToBottom(true), 100);
        }

        function listenForUpdates() {
            db.ref("games/" + gameCode + "/chat").on("value", snapshot => {
                var messages = snapshot.val();
                if (!messages) return;

                var chatContent = Object.values(messages)
                    .map(msg => `<p>${msg}</p>`).join("");
                document.getElementById("chatMessages").innerHTML = chatContent;

                // ✅ Scroll to the bottom when a new message arrives
                setTimeout(() => scrollChatToBottom(true), 100);
            });
        }

        function scrollChatToBottom(animate = true) {
            var chatBox = $(".chatbox");
            if (animate) {
                chatBox.animate({ scrollTop: chatBox.prop("scrollHeight") }, 500);
            } else {
                chatBox.scrollTop(chatBox.prop("scrollHeight"));
            }
        }
    </script>
</head>
<body>
    <h1>9upper Online Multiplayer</h1>

    <div id="nameInput">
        <input type="text" id="playerNameInput" placeholder="Enter Your Name">
        <button onclick="confirmName()">Continue</button>
    </div>

    <div id="setupArea" class="hidden">
        <button onclick="createGame()">Create Game</button>
        <input type="text" id="gameCodeInput" placeholder="Enter Game Code">
        <button onclick="joinGame()">Join Game</button>
    </div>

    <div id="gameArea" class="hidden">
        <h2>Game Code: <span id="gameCodeDisplay"></span></h2>

        <!-- ✅ Chatbox with Auto-Scroll -->
        <div class="chatbox">
            <div id="chatMessages"></div>
        </div>
        <input type="text" id="chatInput" placeholder="Type a message">
        <button onclick="sendChatMessage()">Send</button>
    </div>
</body>
</html>
