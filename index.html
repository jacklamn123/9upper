<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9upper Online</title>

    <!-- ✅ Load Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .hidden {
            display: none;
        }
        .chatbox {
            width: 300px;
            height: 200px;
            border: 1px solid black;
            overflow-y: auto;
            margin: 10px auto;
            text-align: left;
            padding: 5px;
            background-color: #f0f0f0;
        }
        .definition-box {
            border: 1px solid #000;
            padding: 10px;
            margin: 10px;
            cursor: pointer;
            background-color: #f0f0f0;
        }
    </style>

    <script>
        // ✅ Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB1PPLZl8380-xEpyVX3z8ya9eRji2H-uk",
            authDomain: "upper-2c864.firebaseapp.com",
            databaseURL: "https://upper-2c864-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "upper-2c864",
            storageBucket: "upper-2c864.firebasestorage.app",
            messagingSenderId: "1065732661608",
            appId: "1:1065732661608:web:2db40ab8d60697b34f6dd",
            measurementId: "G-F348XKS47Q"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
    </script>
</head>
<body>
    <h1>9upper Online Multiplayer</h1>

    <!-- ✅ Name Input Before Creating/Joining -->
    <div id="nameInput">
        <input type="text" id="playerNameInput" placeholder="Enter Your Name">
        <button onclick="confirmName()">Continue</button>
    </div>

    <div id="setupArea" class="hidden">
        <button onclick="createGame()">Create Game</button>
        <input type="text" id="gameCodeInput" placeholder="Enter Game Code">
        <button onclick="joinGame()">Join Game</button>
    </div>

    <div id="gameArea" class="hidden">
        <h2>Game Code: <span id="gameCodeDisplay"></span></h2>

        <!-- ✅ Waiting Room: Display Players -->
        <div id="waitingRoom">
            <h2>Players in Room</h2>
            <div id="playerList"></div>
            <button id="startGameButton" class="hidden" onclick="startGame()">Start Game</button>
        </div>

        <!-- ✅ Chatbox -->
        <div class="chatbox" id="chatbox">
            <h3>Chat</h3>
            <div id="chatMessages"></div>
        </div>
        <input type="text" id="chatInput" placeholder="Type a message...">
        <button onclick="sendChatMessage()">Send</button>

        <!-- ✅ Game Screen -->
        <div id="gameScreen" class="hidden">
            <h3>Round 1</h3>
            <h3>Term: <span id="gameTerm"></span></h3>
            <h3>Your Role: <span id="playerRole"></span></h3>
            <div id="correctDefinitionBox" class="hidden">
                <h3>Correct Definition: <span id="correctDefinition"></span></h3>
            </div>
            <div id="definitionInputBox" class="hidden">
                <textarea id="fakeDefinitionInput" placeholder="Enter your fake definition..."></textarea>
                <button onclick="submitFakeDefinition()">Submit</button>
            </div>
            <div id="judgeSelectionBox" class="hidden">
                <h3>Pick the correct definition:</h3>
                <div id="definitionOptions"></div>
            </div>
        </div>
    </div>

    <script>
        var gameCode = ""; 
        var playerName = "";

        function confirmName() {
            playerName = document.getElementById("playerNameInput").value.trim();
            if (playerName === "") {
                alert("Please enter a valid name!");
                return;
            }
            document.getElementById("nameInput").classList.add("hidden");
            document.getElementById("setupArea").classList.remove("hidden");
        }

        function startGame() {
            fetch("9upper_terms.json")  // ✅ Load terms from JSON file
                .then(response => response.json())
                .then(terms => {
                    db.ref("games/" + gameCode + "/players").once("value", function(snapshot) {
                        var players = Object.keys(snapshot.val());
                        if (players.length < 3) {
                            alert("At least 3 players are needed to start the game!");
                            return;
                        }

                        // ✅ Assign Roles Randomly
                        var judge = players[Math.floor(Math.random() * players.length)];
                        var correctPlayer = players.filter(p => p !== judge)[Math.floor(Math.random() * (players.length - 1))];

                        var roles = {};
                        players.forEach(p => roles[p] = "Fake Definition");
                        roles[judge] = "Judge";
                        roles[correctPlayer] = "Correct Definition";

                        // ✅ Pick a Random Term from JSON
                        var randomIndex = Math.floor(Math.random() * terms.length);
                        var randomTerm = terms[randomIndex].term;
                        var correctDefinition = terms[randomIndex].definition;

                        db.ref("games/" + gameCode).update({
                            status: "playing",
                            term: randomTerm,
                            correctDefinition: correctDefinition,
                            roles: roles
                        });
                    });
                })
                .catch(error => console.error("Error loading terms:", error));
        }

        function sendChatMessage() {
            var message = document.getElementById("chatInput").value.trim();
            if (message === "") return;
            db.ref("games/" + gameCode + "/chat").push(playerName + ": " + message);
            document.getElementById("chatInput").value = "";
        }
    </script>
</body>
</html>
