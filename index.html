<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9upper Online</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        #gameArea {
            display: none;
        }
        .definition-box {
            border: 1px solid #000;
            padding: 10px;
            margin: 10px;
            cursor: pointer;
            background-color: #f0f0f0;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>9upper Online</h1>
    <div id="setupArea">
        <label>Enter number of players:</label>
        <input type="number" id="playerCount" min="3" max="10" value="3">
        <button onclick="startGame()">Start Game</button>
    </div>

    <div id="gameArea">
        <h2 id="roundInfo"></h2>
        <div id="termDisplay"></div>
        <div id="definitionForm" class="hidden">
            <textarea id="playerDefinition" placeholder="Enter your definition..."></textarea>
            <button onclick="submitDefinition()">Submit</button>
        </div>
        <div id="definitionChoices" class="hidden"></div>
        <div id="judgeDecision" class="hidden">
            <h3>Pick the correct definition:</h3>
            <div id="judgeOptions"></div>
        </div>
        <div id="results" class="hidden"></div>
        <button id="nextRound" class="hidden" onclick="nextRound()">Next Round</button>
    </div>

    <script>
        let terms = [];
        let currentTerm = {};
        let players = [];
        let judgeIndex = 0;
        let genuineIndex = 0;
        let definitions = [];
        let submittedDefinitions = [];
        let round = 0;

        async function startGame() {
            const response = await fetch("9upper_terms.json");
            terms = await response.json();

            const playerCount = parseInt(document.getElementById("playerCount").value);
            if (playerCount < 3) {
                alert("At least 3 players required.");
                return;
            }

            players = Array.from({length: playerCount}, (_, i) => `Player ${i+1}`);
            document.getElementById("setupArea").style.display = "none";
            document.getElementById("gameArea").style.display = "block";
            
            nextRound();
        }

        function nextRound() {
            round++;
            definitions = [];
            submittedDefinitions = [];
            document.getElementById("definitionChoices").innerHTML = "";
            document.getElementById("judgeOptions").innerHTML = "";
            document.getElementById("results").innerHTML = "";
            
            currentTerm = terms[Math.floor(Math.random() * terms.length)];
            judgeIndex = round % players.length;
            genuineIndex = (judgeIndex + 1) % players.length;

            document.getElementById("roundInfo").innerText = `Round ${round} - ${players[judgeIndex]} is the Judge`;
            document.getElementById("termDisplay").innerHTML = `<h3>Term: ${currentTerm.term}</h3>`;
            document.getElementById("definitionForm").classList.remove("hidden");
        }

        function submitDefinition() {
            const input = document.getElementById("playerDefinition").value.trim();
            if (!input) {
                alert("Please enter a definition.");
                return;
            }

            submittedDefinitions.push(input);
            document.getElementById("playerDefinition").value = "";

            if (submittedDefinitions.length === players.length - 1) {
                showDefinitions();
            }
        }

        function showDefinitions() {
            document.getElementById("definitionForm").classList.add("hidden");
            submittedDefinitions.push(currentTerm.definition);
            submittedDefinitions.sort(() => Math.random() - 0.5);

            document.getElementById("definitionChoices").classList.remove("hidden");
            document.getElementById("judgeOptions").innerHTML = submittedDefinitions.map((def, index) => 
                `<div class="definition-box" onclick="judgePick(${index})">${def}</div>`).join("");
            document.getElementById("judgeDecision").classList.remove("hidden");
        }

        function judgePick(index) {
            let resultText = (submittedDefinitions[index] === currentTerm.definition) ? "Correct! The judge found the real definition." : "Wrong! The judge picked a fake definition.";
            document.getElementById("results").innerHTML = `<h3>${resultText}</h3><p>The real definition was: ${currentTerm.definition}</p>`;
            document.getElementById("judgeDecision").classList.add("hidden");
            document.getElementById("results").classList.remove("hidden");
            document.getElementById("nextRound").classList.remove("hidden");
        }
    </script>
</body>
</html>
