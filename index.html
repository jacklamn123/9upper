<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9upper Online</title>

    <!-- ✅ Load Firebase Scripts Once (In <head>) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .hidden {
            display: none;
        }
        .definition-box {
            border: 1px solid #000;
            padding: 10px;
            margin: 10px;
            cursor: pointer;
            background-color: #f0f0f0;
        }
    </style>

    <script>
        // ✅ Initialize Firebase Before Using It
        const firebaseConfig = {
            apiKey: "AIzaSyB1PPLZl8380-xEpyVX3z8ya9eRji2H-uk",
            authDomain: "upper-2c864.firebaseapp.com",
            databaseURL: "https://upper-2c864-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "upper-2c864",
            storageBucket: "upper-2c864.firebasestorage.app",
            messagingSenderId: "1065732661608",
            appId: "1:1065732661608:web:2db40ab8d60697b34f6dd",
            measurementId: "G-F348XKS47Q"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
    </script>
</head>
<body>
    <h1>9upper Online Multiplayer</h1>
    
    <div id="setupArea">
        <button onclick="createGame()">Create Game</button>
        <input type="text" id="gameCodeInput" placeholder="Enter Game Code">
        <button onclick="joinGame()">Join Game</button>
    </div>
    
    <div id="gameArea" class="hidden">
        <h2>Game Code: <span id="gameCodeDisplay"></span></h2>
        <h3 id="roundInfo"></h3>
        <div id="termDisplay"></div>
        <div id="definitionForm" class="hidden">
            <textarea id="playerDefinition" placeholder="Enter your definition..."></textarea>
            <button onclick="submitDefinition()">Submit</button>
        </div>
        <div id="judgeDecision" class="hidden">
            <h3>Pick the correct definition:</h3>
            <div id="judgeOptions"></div>
        </div>
        <div id="results" class="hidden"></div>
        <button id="nextRound" class="hidden" onclick="nextRound()">Next Round</button>
    </div>

    <!-- ✅ Game Logic (After Firebase Initialization) -->
    <script>
        var gameCode = ""; 
        var playerName = "Player" + Math.floor(Math.random() * 1000);
        var terms = ["Gobbledegook", "Zzyzx", "Faff", "Dullsville", "Nowheresville", "Flibbertigibbet", "Peculiar Knob", "Curmudgeon", "Why, Arizona", "Chinwag", "Bumfuzzle", "Snollygoster", "Wagga Wagga", "Lollygag", "Llanfairpwllgwyngyll", "Discombobulate", "Bonkers", "Taradiddle", "Absquatulate", "Gadzooks"];

        function createGame() {
            gameCode = Math.random().toString(36).substr(2, 6).toUpperCase();
            var randomTerm = terms[Math.floor(Math.random() * terms.length)];
            db.ref("games/" + gameCode).set({
                round: 1,
                term: randomTerm,
                definitions: {},
                judge: "",
                status: "waiting"
            }).then(function() {
                document.getElementById("gameCodeDisplay").innerText = gameCode;
                document.getElementById("setupArea").classList.add("hidden");
                document.getElementById("gameArea").classList.remove("hidden");
            }).catch(function(error) {
                console.error("Database Error:", error);
            });
        }

        function joinGame() {
            gameCode = document.getElementById("gameCodeInput").value.toUpperCase();
            if (!gameCode) {
                alert("Please enter a valid game code!");
                return;
            }
            db.ref("games/" + gameCode).get().then(function(snapshot) {
                if (snapshot.exists()) {
                    document.getElementById("gameCodeDisplay").innerText = gameCode;
                    document.getElementById("setupArea").classList.add("hidden");
                    document.getElementById("gameArea").classList.remove("hidden");
                    listenForUpdates();
                } else {
                    alert("Game not found!");
                }
            }).catch(function(error) {
                console.error("Firebase Error:", error);
            });
        }

        function submitDefinition() {
            var definition = document.getElementById("playerDefinition").value;
            db.ref("games/" + gameCode + "/definitions/").push({ player: playerName, definition: definition });
        }

        function listenForUpdates() {
            db.ref("games/" + gameCode + "/definitions").on("value", function(snapshot) {
                var definitions = snapshot.val();
                if (definitions) {
                    document.getElementById("judgeOptions").innerHTML = Object.values(definitions).map(function(def) {
                        return `<div class='definition-box' onclick='judgePick("${def.definition}")'>${def.definition}</div>`;
                    }).join("");
                    document.getElementById("judgeDecision").classList.remove("hidden");
                }
            });
        }

        function judgePick(selectedDefinition) {
            document.getElementById("results").innerHTML = `<h3>Judge selected: ${selectedDefinition}</h3>`;
            document.getElementById("judgeDecision").classList.add("hidden");
            document.getElementById("results").classList.remove("hidden");
            document.getElementById("nextRound").classList.remove("hidden");
        }

        function nextRound() {
            var randomTerm = terms[Math.floor(Math.random() * terms.length)];
            db.ref("games/" + gameCode).update({
                round: firebase.database.ServerValue.increment(1),
                term: randomTerm,
                definitions: {},
                status: "playing"
            });
        }
    </script>
</body>
</html>
